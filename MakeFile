CC = gcc
TARGET = main
SRC = src/main.c src/math_utils.c src/camera.c src/physics.c src/grid.c src/shaders.c src/renderer.c src/callbacks.c

UNAME_S := $(shell uname -s)

ifeq ($(UNAME_S),Darwin)
    # macOS (Homebrew + frameworks)
    CFLAGS = -Iinclude -I/opt/homebrew/include
    LDFLAGS = -L/opt/homebrew/lib -lglfw -framework OpenGL -framework Cocoa -framework IOKit -framework CoreVideo
else
    # Linux (WSL/Ubuntu): link with libglfw, libGL and GLEW
    CFLAGS = -Iinclude
    LDFLAGS = -lglfw -lGL -lGLEW -lm -ldl
endif

all: $(TARGET)

$(TARGET): $(SRC)
	$(CC) -std=c11 -O2 -Wall $(CFLAGS) $^ -o $@ $(LDFLAGS)

run: $(TARGET)
	./$(TARGET)

clean:
	rm -f $(TARGET)